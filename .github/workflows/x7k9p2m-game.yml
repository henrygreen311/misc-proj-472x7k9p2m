name: Run NeoBux-game Script

on:
  workflow_dispatch:  # Manually trigger from GitHub Actions
  schedule:
    - cron: "0 0 * * *"    # 00:00 UTC
    - cron: "5 8 * * *"    # 08:05 UTC (8h 5m after 00:00)
    - cron: "10 16 * * *"  # 16:10 UTC (8h 5m after 08:05)

concurrency:
  group: neobux-game
  cancel-in-progress: true

jobs:
  automate:
    runs-on: ubuntu-latest

    steps:  
      - name: Checkout repository  
        uses: actions/checkout@v4  

      - name: Set up Node.js  
        uses: actions/setup-node@v4  
        with:  
          node-version: '18'  

      - name: Install Playwright  
        run: npm install playwright && npx playwright install firefox  

      - name: Run automation script with timeout  
        run: |
          # Set a timeout of 330 minutes (19800 seconds) and run the script
          timeout 19800s bash -c 'for i in {1..100}; do echo "Running iteration $i"; node neox7k9p2m.js; done' || exit 0
        env:  
          DISPLAY: ':99.0'  # Enable Xvfb to run headless
